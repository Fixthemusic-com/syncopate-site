# Syncopate Web

Marketing site, blog, and SDK documentation for [syncopate.chat](https://syncopate.chat).

Built with **Astro** + **Starlight** (docs). Deployed to GitHub Pages via a separate [`syncopate-site`](https://github.com/Fixthemusic-com/syncopate-site) repo.

## Local Development

Requires the Nix `web` dev shell:

```sh
nix develop .#web
npm install
npm run dev        # http://localhost:4321
```

## Project Structure

```text
src/
├── components/        # Marketing page components (Hero, Features, etc.)
├── content/
│   └── docs/docs/     # Starlight docs content
│       ├── getting-started/   # 3 hand-authored guides
│       ├── guides/            # 5 hand-authored guides
│       ├── api-python/        # 12 pages — generated by pydoc-markdown
│       └── api-typescript/    # 1 page — generated by typedoc
├── pages/             # Marketing pages (index, about, blog)
└── styles/
    └── starlight-overrides.css  # Syncopate brand theming
```

## Regenerating API Reference

API docs are **generated locally** and committed as content (they're not generated in CI because the SDK source lives in the main `syncopate` monorepo, not in `syncopate-site`).

### Python SDK

Requires `pydoc-markdown` (listed as a dev dep in `sdk/python/pyproject.toml`):

```sh
# From the repo root:
nix-shell -p uv python312 --run "
  cd sdk/python && uv sync --extra dev
  cd ../..
  bash web/scripts/generate-api-docs.sh
"
```

Output: `web/src/content/docs/docs/api-python/*.md` (12 files)

### TypeScript SDK

Requires `typedoc` + `typedoc-plugin-markdown` (listed as devDependencies in `web/package.json`):

```sh
nix develop .#web -c bash -c "bash scripts/generate-api-docs.sh"
```

Output: `web/src/content/docs/docs/api-typescript/*.mdx`

## Deployment

The site is deployed to GitHub Pages via the [`syncopate-site`](https://github.com/Fixthemusic-com/syncopate-site) repo.

### 1. Build locally

```sh
nix develop .#web -c npm run build   # outputs to dist/
```

### 2. Sync to syncopate-site

```sh
rsync -av --delete \
  --exclude '.git' \
  --exclude 'node_modules' \
  --exclude 'dist' \
  --exclude '.astro' \
  web/ \
  ~/syncopate-site/

# Restore CNAME (rsync deletes it since it's not in web/)
echo "syncopate.chat" > ~/syncopate-site/CNAME
```

### 3. Commit and push

```sh
cd ~/syncopate-site
git add -A
git commit -m "deploy: update site"
git push origin master
```

### 4. GitHub Pages

The `syncopate-site` repo has a GitHub Actions workflow (`.github/workflows/deploy.yml`) that:

1. Checks out the repo
2. Installs Node.js dependencies (`npm ci`)
3. Builds the Astro site (`npm run build`)
4. Deploys the `dist/` folder to GitHub Pages via `actions/deploy-pages@v4`

**Required repo setting:** GitHub Pages source must be set to **"GitHub Actions"** (not "Deploy from a branch") in the repo's Settings → Pages.

### CI Workflow

The workflow triggers on:
- Push to `master`
- Manual dispatch (`workflow_dispatch`)

API docs are **not** generated in CI — they must be committed to the repo before pushing.
