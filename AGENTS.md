# Syncopate Web — Agent Guide

This is the Syncopate marketing site and SDK documentation, built with Astro + Starlight.

## Development Environment

- Enter the shell with `nix develop .#web` — provides Node.js v24 and npm
- Run `npm install` then `npm run dev` for local dev at `http://localhost:4321`
- Docs are served at `/docs/` via the Starlight integration

## Architecture

### Marketing Site

Standard Astro pages in `src/pages/` (index, about, blog). Components in `src/components/`.

### Documentation (Starlight)

- **Config**: `astro.config.mjs` — Starlight integration with sidebar groups
- **Content schema**: `src/content.config.ts` — uses `docsLoader` + `docsSchema` from Starlight
- **Content location**: `src/content/docs/docs/` — all docs live here
- **Brand theming**: `src/styles/starlight-overrides.css` — cyan accent, dark theme, Outfit font
- **Sidebar order**: controlled by `sidebar.order` in each file's frontmatter

### Content Structure

```
src/content/docs/docs/
├── index.mdx              # Landing page (splash template)
├── getting-started/       # 3 hand-authored guides
├── guides/                # 5 hand-authored guides
├── api-python/            # 12 files — generated by pydoc-markdown
└── api-typescript/        # 1 file — generated by typedoc
```

## API Reference Generation

API docs are **generated locally and committed** — not generated in CI.

### Python (pydoc-markdown)

```sh
# From repo root:
nix-shell -p uv python312 --run "
  cd sdk/python && uv sync --extra dev && cd ../..
  bash web/scripts/generate-api-docs.sh
"
```

- Source: `sdk/python/src/syncopate/`
- Output: `web/src/content/docs/docs/api-python/*.md`
- Uses `.md` (not `.mdx`) to avoid JSX parsing of `@decorator` syntax
- `pydoc-markdown` is a dev dependency in `sdk/python/pyproject.toml`

### TypeScript (typedoc)

```sh
nix develop .#web -c bash -c "bash scripts/generate-api-docs.sh"
```

- Source: `sdk/typescript/src/`
- Output: `web/src/content/docs/docs/api-typescript/*.mdx`
- `typedoc` + `typedoc-plugin-markdown` are devDependencies in `package.json`

## Deployment

The site deploys to GitHub Pages via a **separate repo**: [`syncopate-site`](https://github.com/Fixthemusic-com/syncopate-site).

### Steps

1. **Build**: `nix develop .#web -c npm run build`
2. **Sync**: `rsync -av --delete --exclude '.git' --exclude 'node_modules' --exclude 'dist' --exclude '.astro' web/ ~/syncopate-site/`
3. **Restore CNAME**: `echo "syncopate.chat" > ~/syncopate-site/CNAME`
4. **Push**: `cd ~/syncopate-site && git add -A && git commit -m "deploy: update site" && git push origin master`

### CI Workflow

`syncopate-site` has `.github/workflows/deploy.yml` that:

1. Runs `npm ci` + `npm run build`
2. Uploads `dist/` as a Pages artifact
3. Deploys via `actions/deploy-pages@v4`

**Required setting**: GitHub Pages source must be **"GitHub Actions"** (not "Deploy from a branch").

API docs are **not** generated in CI — they must be committed before pushing.

## Guidelines

- **Frontmatter**: Use `sidebar.order` for doc ordering. Do not use `order` or `section` (those were pre-Starlight).
- **File format**: Use `.md` for generated API docs (avoids MDX parsing issues). Hand-authored docs can use `.mdx`.
- **Starlight features**: Search (Pagefind), dark/light toggle, TOC, code copy buttons, and responsive nav are all built-in — do not reimplement.
- **Custom CSS**: Add overrides to `src/styles/starlight-overrides.css`, not inline styles.
- **CNAME**: Always restore `syncopate.chat` CNAME after rsync (it gets deleted because it's not in the `web/` source).
